# Comparing `tmp/odoo14_addon_stock_warehouse_flow-14.0.1.0.3-py3-none-any.whl.zip` & `tmp/odoo14_addon_stock_warehouse_flow-14.0.2.0.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,37 +1,37 @@
-Zip file size: 132274 bytes, number of entries: 35
--rw-r--r--  2.0 unx     4729 b- defN 22-Nov-16 18:09 odoo/addons/stock_warehouse_flow/README.rst
--rw-r--r--  2.0 unx       21 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/__init__.py
--rw-r--r--  2.0 unx      901 b- defN 22-Nov-16 18:09 odoo/addons/stock_warehouse_flow/__manifest__.py
--rw-r--r--  2.0 unx     1553 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/demo/stock_warehouse_flow.xml
--rw-r--r--  2.0 unx    13460 b- defN 22-Nov-16 18:09 odoo/addons/stock_warehouse_flow/i18n/stock_warehouse_flow.pot
--rw-r--r--  2.0 unx      688 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/migrations/14.0.1.0.1/pre-migrate.py
--rw-r--r--  2.0 unx      156 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/models/__init__.py
--rw-r--r--  2.0 unx      830 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/models/delivery_carrier.py
--rw-r--r--  2.0 unx      910 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/models/stock_location_route.py
--rw-r--r--  2.0 unx      747 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/models/stock_move.py
--rw-r--r--  2.0 unx      686 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/models/stock_warehouse.py
--rw-r--r--  2.0 unx    15527 b- defN 22-Nov-16 18:09 odoo/addons/stock_warehouse_flow/models/stock_warehouse_flow.py
--rw-r--r--  2.0 unx      795 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/readme/CONFIGURE.rst
--rw-r--r--  2.0 unx       89 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/readme/CONTRIBUTORS.rst
--rw-r--r--  2.0 unx      751 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/readme/DESCRIPTION.rst
--rw-r--r--  2.0 unx      112 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/readme/ROADMAP.rst
--rw-r--r--  2.0 unx      130 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/readme/USAGE.rst
--rw-r--r--  2.0 unx      434 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/security/ir.model.access.csv
--rw-r--r--  2.0 unx    62641 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/static/description/config.png
--rw-r--r--  2.0 unx    36432 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/static/description/flow.png
--rw-r--r--  2.0 unx     7354 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/static/description/icon.png
--rw-r--r--  2.0 unx    14923 b- defN 22-Nov-16 18:09 odoo/addons/stock_warehouse_flow/static/description/index.html
--rw-r--r--  2.0 unx       99 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/tests/__init__.py
--rw-r--r--  2.0 unx     2525 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/tests/common.py
--rw-r--r--  2.0 unx      359 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/tests/test_delivery_carrier.py
--rw-r--r--  2.0 unx      363 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/tests/test_warehouse.py
--rw-r--r--  2.0 unx     4333 b- defN 22-Nov-16 18:09 odoo/addons/stock_warehouse_flow/tests/test_warehouse_flow.py
--rw-r--r--  2.0 unx      882 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/views/delivery_carrier.xml
--rw-r--r--  2.0 unx      598 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/views/stock_location_route.xml
--rw-r--r--  2.0 unx      742 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/views/stock_warehouse.xml
--rw-r--r--  2.0 unx     9102 b- defN 22-Nov-16 18:08 odoo/addons/stock_warehouse_flow/views/stock_warehouse_flow.xml
--rw-r--r--  2.0 unx     5390 b- defN 22-Nov-16 18:09 odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 22-Nov-16 18:09 odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/WHEEL
--rw-r--r--  2.0 unx        5 b- defN 22-Nov-16 18:09 odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     3935 b- defN 22-Nov-16 18:09 odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/RECORD
-35 files, 192294 bytes uncompressed, 125558 bytes compressed:  34.7%
+Zip file size: 134427 bytes, number of entries: 35
+-rw-r--r--  2.0 unx     4783 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/README.rst
+-rw-r--r--  2.0 unx       21 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/__init__.py
+-rw-r--r--  2.0 unx      901 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/__manifest__.py
+-rw-r--r--  2.0 unx     1553 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/demo/stock_warehouse_flow.xml
+-rw-r--r--  2.0 unx    14914 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/i18n/stock_warehouse_flow.pot
+-rw-r--r--  2.0 unx      688 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/migrations/14.0.1.0.1/pre-migrate.py
+-rw-r--r--  2.0 unx      156 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/models/__init__.py
+-rw-r--r--  2.0 unx      830 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/models/delivery_carrier.py
+-rw-r--r--  2.0 unx      910 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/models/stock_location_route.py
+-rw-r--r--  2.0 unx     1022 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/models/stock_move.py
+-rw-r--r--  2.0 unx      686 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/models/stock_warehouse.py
+-rw-r--r--  2.0 unx    20247 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/models/stock_warehouse_flow.py
+-rw-r--r--  2.0 unx      795 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/readme/CONFIGURE.rst
+-rw-r--r--  2.0 unx      143 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/readme/CONTRIBUTORS.rst
+-rw-r--r--  2.0 unx      751 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/readme/DESCRIPTION.rst
+-rw-r--r--  2.0 unx      112 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/readme/ROADMAP.rst
+-rw-r--r--  2.0 unx      130 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/readme/USAGE.rst
+-rw-r--r--  2.0 unx      434 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/security/ir.model.access.csv
+-rw-r--r--  2.0 unx    62641 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/static/description/config.png
+-rw-r--r--  2.0 unx    36432 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/static/description/flow.png
+-rw-r--r--  2.0 unx     7354 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/static/description/icon.png
+-rw-r--r--  2.0 unx    15068 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/static/description/index.html
+-rw-r--r--  2.0 unx       99 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/tests/__init__.py
+-rw-r--r--  2.0 unx     3389 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/tests/common.py
+-rw-r--r--  2.0 unx      359 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/tests/test_delivery_carrier.py
+-rw-r--r--  2.0 unx      363 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/tests/test_warehouse.py
+-rw-r--r--  2.0 unx     5587 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/tests/test_warehouse_flow.py
+-rw-r--r--  2.0 unx      882 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/views/delivery_carrier.xml
+-rw-r--r--  2.0 unx      598 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/views/stock_location_route.xml
+-rw-r--r--  2.0 unx      742 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/views/stock_warehouse.xml
+-rw-r--r--  2.0 unx    10068 b- defN 23-Jul-24 15:19 odoo/addons/stock_warehouse_flow/views/stock_warehouse_flow.xml
+-rw-r--r--  2.0 unx     5444 b- defN 23-Jul-24 15:19 odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-24 15:19 odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/WHEEL
+-rw-r--r--  2.0 unx        5 b- defN 23-Jul-24 15:19 odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     3938 b- defN 23-Jul-24 15:19 odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/RECORD
+35 files, 202137 bytes uncompressed, 127711 bytes compressed:  36.8%
```

## zipnote {}

```diff
@@ -87,20 +87,20 @@
 
 Filename: odoo/addons/stock_warehouse_flow/views/stock_warehouse.xml
 Comment: 
 
 Filename: odoo/addons/stock_warehouse_flow/views/stock_warehouse_flow.xml
 Comment: 
 
-Filename: odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/METADATA
+Filename: odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/METADATA
 Comment: 
 
-Filename: odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/WHEEL
+Filename: odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/WHEEL
 Comment: 
 
-Filename: odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/top_level.txt
+Filename: odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/top_level.txt
 Comment: 
 
-Filename: odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/RECORD
+Filename: odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## odoo/addons/stock_warehouse_flow/README.rst

```diff
@@ -108,14 +108,15 @@
 * BCIM
 
 Contributors
 ~~~~~~~~~~~~
 
 * SÃ©bastien Alix <sebastien.alix@camptocamp.com>
 * Jacques-Etienne Baudoux <je@bcim.be>
+* Michael Tietz (MT Software) <mtietz@mt-software.de>
 
 Maintainers
 ~~~~~~~~~~~
 
 This module is maintained by the OCA.
 
 .. image:: https://odoo-community.org/logo.png
```

## odoo/addons/stock_warehouse_flow/__manifest__.py

```diff
@@ -2,15 +2,15 @@
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl)
 {
     "name": "Stock Warehouse Flow",
     "summary": "Configure routing flow for stock moves",
     "author": "Camptocamp, BCIM, Odoo Community Association (OCA)",
     "website": "https://github.com/OCA/wms",
     "category": "Warehouse Management",
-    "version": "14.0.1.0.3",
+    "version": "14.0.2.0.0",
     "license": "AGPL-3",
     "depends": [
         # core
         "stock",
         "delivery",
         # OCA/stock-logistics-workflow
         "delivery_procurement_group_carrier",
```

## odoo/addons/stock_warehouse_flow/i18n/stock_warehouse_flow.pot

```diff
@@ -128,14 +128,21 @@
 #: model:ir.model.fields,field_description:stock_warehouse_flow.field_stock_move__id
 #: model:ir.model.fields,field_description:stock_warehouse_flow.field_stock_warehouse__id
 #: model:ir.model.fields,field_description:stock_warehouse_flow.field_stock_warehouse_flow__id
 msgid "ID"
 msgstr ""
 
 #. module: stock_warehouse_flow
+#: model:ir.model.fields,help:stock_warehouse_flow.field_stock_warehouse_flow__qty
+msgid ""
+"If a qty is set the flow can be applied on moves where the move's qty >= the"
+" qty set on the flow\n"
+msgstr ""
+
+#. module: stock_warehouse_flow
 #: model:ir.model.fields,field_description:stock_warehouse_flow.field_stock_warehouse_flow__impacted_route_ids
 msgid "Impacted Routes"
 msgstr ""
 
 #. module: stock_warehouse_flow
 #: model_terms:ir.ui.view,arch_db:stock_warehouse_flow.stock_warehouse_flow_view_form
 msgid "Impacted routes"
@@ -167,14 +174,19 @@
 
 #. module: stock_warehouse_flow
 #: model_terms:ir.ui.view,arch_db:stock_warehouse_flow.stock_warehouse_flow_view_form
 msgid "Locations"
 msgstr ""
 
 #. module: stock_warehouse_flow
+#: model_terms:ir.ui.view,arch_db:stock_warehouse_flow.stock_warehouse_flow_view_form
+msgid "Max quantity multiple"
+msgstr ""
+
+#. module: stock_warehouse_flow
 #: model:ir.model.fields,field_description:stock_warehouse_flow.field_stock_warehouse_flow__name
 msgid "Name"
 msgstr ""
 
 #. module: stock_warehouse_flow
 #: code:addons/stock_warehouse_flow/models/stock_warehouse_flow.py:0
 #, python-format
@@ -231,14 +243,25 @@
 
 #. module: stock_warehouse_flow
 #: model:ir.model.fields,field_description:stock_warehouse_flow.field_stock_warehouse_flow__pick_type_id
 msgid "Pick Type"
 msgstr ""
 
 #. module: stock_warehouse_flow
+#: code:addons/stock_warehouse_flow/models/stock_warehouse_flow.py:0
+#, python-format
+msgid "Please set the uom field in addition to the qty field"
+msgstr ""
+
+#. module: stock_warehouse_flow
+#: model:ir.model.fields,field_description:stock_warehouse_flow.field_stock_warehouse_flow__qty
+msgid "Qty"
+msgstr ""
+
+#. module: stock_warehouse_flow
 #: model:ir.model.fields,field_description:stock_warehouse_flow.field_stock_location_route__flow_id
 msgid "Routing Flow"
 msgstr ""
 
 #. module: stock_warehouse_flow
 #: model:ir.actions.act_window,name:stock_warehouse_flow.stock_warehouse_flow_action
 #: model:ir.ui.menu,name:stock_warehouse_flow.stock_warehouse_flow_menu
@@ -290,19 +313,35 @@
 
 #. module: stock_warehouse_flow
 #: model:ir.model,name:stock_warehouse_flow.model_delivery_carrier
 msgid "Shipping Methods"
 msgstr ""
 
 #. module: stock_warehouse_flow
+#: model:ir.model.fields.selection,name:stock_warehouse_flow.selection__stock_warehouse_flow__split_method__simple
+msgid "Simple"
+msgstr ""
+
+#. module: stock_warehouse_flow
+#: model:ir.model.fields,help:stock_warehouse_flow.field_stock_warehouse_flow__split_method
+msgid ""
+"Simple => move will be split by the qty of the flow or a multiple of it"
+msgstr ""
+
+#. module: stock_warehouse_flow
 #: model:ir.model.fields,field_description:stock_warehouse_flow.field_stock_warehouse_flow__move_domain
 msgid "Source Routing Domain"
 msgstr ""
 
 #. module: stock_warehouse_flow
+#: model:ir.model.fields,field_description:stock_warehouse_flow.field_stock_warehouse_flow__split_method
+msgid "Split method"
+msgstr ""
+
+#. module: stock_warehouse_flow
 #: model:ir.model,name:stock_warehouse_flow.model_stock_move
 msgid "Stock Move"
 msgstr ""
 
 #. module: stock_warehouse_flow
 #: model:ir.model,name:stock_warehouse_flow.model_stock_warehouse_flow
 msgid "Stock Warehouse Routing Flow"
@@ -331,14 +370,19 @@
 
 #. module: stock_warehouse_flow
 #: model:ir.model.fields,field_description:stock_warehouse_flow.field_stock_warehouse_flow__to_output_stock_loc_id
 msgid "To output location"
 msgstr ""
 
 #. module: stock_warehouse_flow
+#: model:ir.model.fields,field_description:stock_warehouse_flow.field_stock_warehouse_flow__uom_id
+msgid "Uom"
+msgstr ""
+
+#. module: stock_warehouse_flow
 #: model:ir.model.fields,help:stock_warehouse_flow.field_stock_warehouse_flow__sequence_prefix
 msgid ""
 "Used to generate the default prefix of new operation types. (e.g. 'DG' => "
 "'WH/OUT/DG/')"
 msgstr ""
 
 #. module: stock_warehouse_flow
```

## odoo/addons/stock_warehouse_flow/models/stock_move.py

```diff
@@ -1,21 +1,27 @@
 # Copyright 2022 Camptocamp SA
+# Copyright 2023 Michael Tietz (MT Software) <mtietz@mt-software.de>
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl)
 
 from odoo import models
 
 
 class StockMove(models.Model):
     _inherit = "stock.move"
 
     def _action_confirm(self, merge=True, merge_into=False):
         # Apply the flow configuration on the move before it generates
         # its chained moves (if any)
+        FLOW = self.env["stock.warehouse.flow"]
+        move_ids_to_confirm = []
         for move in self:
             if not move._apply_flow_on_action_confirm():
+                move_ids_to_confirm.append(move.id)
                 continue
-            flow = self.env["stock.warehouse.flow"]._search_for_move(move)
-            flow._apply_on_move(move)
-        return super()._action_confirm(merge=merge, merge_into=merge_into)
+            move_ids_to_confirm += FLOW._search_and_apply_for_move(move).ids
+        moves_to_confirm = self.browse(move_ids_to_confirm)
+        return super(StockMove, moves_to_confirm)._action_confirm(
+            merge=merge, merge_into=merge_into
+        )
 
     def _apply_flow_on_action_confirm(self):
         return self.picking_type_id.code == "outgoing"
```

## odoo/addons/stock_warehouse_flow/models/stock_warehouse_flow.py

```diff
@@ -1,14 +1,17 @@
 # Copyright 2022 Camptocamp SA
+# Copyright 2023 Michael Tietz (MT Software) <mtietz@mt-software.de>
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl)
 
 import logging
 
 from odoo import _, api, fields, models
 from odoo.exceptions import UserError
+from odoo.osv import expression
+from odoo.tools import float_compare
 from odoo.tools.safe_eval import safe_eval
 
 logger = logging.getLogger(__name__)
 
 
 class StockWarehouseFlow(models.Model):
     _name = "stock.warehouse.flow"
@@ -132,14 +135,28 @@
         string="Out Type",
         readonly=True,
         help=(
             "Same than 'To operation type' field, displayed here to get a "
             "global overview of the flow configuration."
         ),
     )
+    qty = fields.Float(
+        "Qty",
+        default=0,
+        help="If a qty is set the flow can be applied on moves "
+        "where the move's qty >= the qty set on the flow\n",
+    )
+    uom_id = fields.Many2one(
+        "uom.uom", "Uom", default=lambda self: self.env.ref("uom.product_uom_unit")
+    )
+    split_method = fields.Selection(
+        [("simple", "Simple")],
+        "Split method",
+        help="Simple => move will be split by the qty of the flow or a multiple of it",
+    )
 
     def _default_warehouse_id(self):
         warehouse = self.env["stock.warehouse"].search([])
         if len(warehouse) == 1:
             return warehouse
 
     @api.depends("from_picking_type_id.default_location_src_id")
@@ -172,32 +189,60 @@
         for flow in self:
             flow.warning = False
             try:
                 flow._get_rule_from_delivery_route(html_exc=True)
             except UserError as exc:
                 flow.warning = str(exc)
 
-    @api.constrains(
-        "warehouse_id", "from_picking_type_id", "carrier_ids", "move_domain"
-    )
-    def _constrains_uniq(self):
-        args = [
-            ("warehouse_id", "=", self.warehouse_id.id),
-            ("from_picking_type_id", "=", self.from_picking_type_id.id),
-        ]
-        flows = self.search(args) - self
-        for flow in flows:
-            if (
+    def _are_apply_conditions_equal(self, flow):
+        self.ensure_one()
+        flow.ensure_one()
+        if (
+            (
                 self.carrier_ids & flow.carrier_ids
                 or not self.carrier_ids
                 and not flow.carrier_ids
-            ) and self.move_domain == flow.move_domain:
+            )
+            and self.move_domain == flow.move_domain
+            and self.qty == flow.qty
+            and self.uom_id == flow.uom_id
+            and self.split_method == flow.split_method
+        ):
+            return True
+        return False
+
+    @api.constrains(
+        "warehouse_id",
+        "from_picking_type_id",
+        "carrier_ids",
+        "move_domain",
+        "qty",
+        "uom_id",
+        "split_method",
+    )
+    def _constrains_uniq(self):
+        for record in self:
+            args = [
+                ("warehouse_id", "=", record.warehouse_id.id),
+                ("from_picking_type_id", "=", record.from_picking_type_id.id),
+            ]
+            flows = record.search(args) - record
+            for flow in flows:
+                if record._are_apply_conditions_equal(flow):
+                    raise UserError(
+                        _("Existing flow '%s' already applies on these kind of moves.")
+                        % flow.name
+                    )
+
+    @api.constrains("qty", "uom_id")
+    def _constrains_qty_uom(self):
+        for record in self:
+            if record.qty and not record.uom_id:
                 raise UserError(
-                    _("Existing flow '%s' already applies on these kind of moves.")
-                    % flow.name
+                    _("Please set the uom field in addition to the qty field")
                 )
 
     @api.onchange("name")
     def onchange_name(self):
         self.sequence_prefix = "".join(
             [w[0] for w in (self.name or "").split()]
         ).upper()
@@ -330,40 +375,81 @@
             ("from_picking_type_id", "=", move.picking_type_id.id),
             ("delivery_route_id", "!=", False),
         ]
         if move.group_id.carrier_id:
             domain.append(("carrier_ids", "in", move.group_id.carrier_id.ids))
         else:
             domain.append(("carrier_ids", "=", False))
-        return domain
+        qty_uom_domain = expression.OR(
+            [
+                [("qty", "=", False)],
+                [
+                    ("uom_id.category_id", "=", move.product_uom_category_id.id),
+                ],
+            ]
+        )
+        return expression.AND([domain, qty_uom_domain])
 
-    def _is_valid_for_move(self, move):
-        self.ensure_one()
+    def _is_domain_valid_for_move(self, move):
         if not self.move_domain:
             return move
         domain = safe_eval(self.move_domain or "[]")
         if not domain:
             return move
         return move.filtered_domain(domain)
 
+    def _is_qty_valid_for_move(self, move):
+        if not self.qty:
+            return move
+        if self.uom_id.category_id != move.product_uom_category_id:
+            return move.browse()
+        qty = self.uom_id._compute_quantity(self.qty, move.product_id.uom_id)
+        if qty <= move.product_qty:
+            return move
+        return move.browse()
+
+    def _is_valid_for_move(self, move):
+        self.ensure_one()
+        move = self._is_domain_valid_for_move(move)
+        if not move:
+            return move
+        return self._is_qty_valid_for_move(move)
+
     @api.model
     def _search_for_move(self, move):
-        """Return the first flow matching the move."""
+        """Return matching flows for given move"""
         domain = self._search_for_move_domain(move)
-        flows = self.search(domain)
-        for flow in flows:
-            if flow._is_valid_for_move(move):
-                return flow
-        if flows:
-            raise UserError(
-                _(
-                    "No routing flow available for the move {move} in transfer {picking}."
-                ).format(move=move.display_name, picking=move.picking_id.name)
-            )
-        return self.browse()
+        return self.search(domain)
+
+    @api.model
+    def _search_and_apply_for_move(self, move):
+        move.ensure_one()
+        flows = self._search_for_move(move)
+        if not flows:
+            return move
+        return flows.apply_on_move(move)
+
+    def apply_on_move(self, move):
+        move_ids = []
+        flows = self
+        for flow in self:
+            if not flow._is_valid_for_move(move):
+                continue
+            move_ids.append(move.id)
+            split_moves = flow.split_move(move)
+            # Try to apply the rest of the flows to the split move
+            for split_move in split_moves:
+                move_ids += (flows - flow).apply_on_move(split_move).ids
+            flow._apply_on_move(move)
+            return move.browse(move_ids)
+        raise UserError(
+            _(
+                "No routing flow available for the move {move} in transfer {picking}."
+            ).format(move=move.display_name, picking=move.picking_id.name)
+        )
 
     def _get_rule_from_delivery_route(self, html_exc=False):
         rule = self.delivery_route_id.rule_ids.filtered(
             lambda r: r.picking_type_id == self.to_picking_type_id
         )
         if self.delivery_route_id and not rule:
             args = {
@@ -381,14 +467,59 @@
                     "has been found on delivery route '%(delivery_route)s'.\n"
                     "Please check your configuration."
                 )
                 % args
             )
         return rule
 
+    def _prepare_move_split_vals(self, move, split_qty):
+        split_qty_uom = move.product_id.uom_id._compute_quantity(
+            split_qty, move.product_uom, rounding_method="HALF-UP"
+        )
+        return move._prepare_move_split_vals(split_qty_uom)
+
+    def _split_move(self, move, split_qty):
+        split_move = move.copy(self._prepare_move_split_vals(move, split_qty))
+        new_product_qty = move.product_id.uom_id._compute_quantity(
+            move.product_qty - split_qty, move.product_uom, round=False
+        )
+        move.product_uom_qty = new_product_qty
+        return split_move
+
+    def _get_split_qty_multiple_of(self, move, qty, uom=None):
+        """Returns the qty to split
+        split qty = move.product_qty - (a multiple of the given qty)"""
+        product_uom = move.product_id.uom_id
+        if uom:
+            qty = uom._compute_quantity(qty, product_uom)
+        rounding = product_uom.rounding
+        if float_compare(qty, move.product_qty, precision_rounding=rounding) > 0:
+            return
+        multiple_qty = int(move.product_qty / qty) * qty
+        split_qty = move.product_qty - multiple_qty
+        # There is nothing to split if the split_qty is 0
+        # then the move qty is the same or a multiple of the qty
+        if float_compare(split_qty, 0, precision_rounding=rounding) <= 0:
+            return
+        return split_qty
+
+    def _split_move_simple(self, move):
+        split_moves = move.browse([])
+        split_qty = self._get_split_qty_multiple_of(move, self.qty, self.uom_id)
+        if not split_qty:
+            return split_moves
+        return self._split_move(move, split_qty)
+
+    def split_move(self, move):
+        self.ensure_one()
+        split_moves = move.browse([])
+        if self.split_method == "simple":
+            return self._split_move_simple(move)
+        return split_moves
+
     def _apply_on_move(self, move):
         """Apply the flow configuration on the move."""
         if not self:
             return False
         logger.info("Applying flow '%s' on '%s'", self.name, move)
         rule = self._get_rule_from_delivery_route()
         move.picking_id = False
```

## odoo/addons/stock_warehouse_flow/readme/CONTRIBUTORS.rst

```diff
@@ -1,2 +1,3 @@
 * SÃ©bastien Alix <sebastien.alix@camptocamp.com>
 * Jacques-Etienne Baudoux <je@bcim.be>
+* Michael Tietz (MT Software) <mtietz@mt-software.de>
```

## odoo/addons/stock_warehouse_flow/static/description/index.html

### odoo/addons/stock_warehouse_flow/static/description/index.html

```diff
@@ -511,14 +511,19 @@
               &gt;
             </li>
             <li>
               Jacques-Etienne Baudoux &lt;
               <a class="reference external" href="mailto:je@bcim.be">je@bcim.be</a>
               &gt;
             </li>
+            <li>
+              Michael Tietz (MT Software) &lt;
+              <a class="reference external" href="mailto:mtietz@mt-software.de">mtietz@mt-software.de</a>
+              &gt;
+            </li>
           </ul>
         </div>
         <div class="section" id="maintainers">
           <h2>
             <a class="toc-backref" href="#id8">Maintainers</a>
           </h2>
           <p>This module is maintained by the OCA.</p>
```

## odoo/addons/stock_warehouse_flow/tests/common.py

```diff
@@ -1,8 +1,9 @@
 # Copyright 2022 Camptocamp SA
+# Copyright 2023 Michael Tietz (MT Software) <mtietz@mt-software.de>
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl)
 
 from odoo import fields
 from odoo.tests.common import SavepointCase
 
 
 class CommonFlow(SavepointCase):
@@ -64,7 +65,28 @@
         )
         proc_group.run([procurement])
 
     def _validate_picking(self, picking):
         for move_line in picking.move_line_ids:
             move_line.qty_done = move_line.product_uom_qty
         picking._action_done()
+
+    def _prepare_split_test(self, qty=None):
+        ship_flow = self._get_flow("ship_only")
+        ship_flow.sequence = 100
+        pick_flow = self._get_flow("pick_ship")
+        pick_flow.write(
+            {
+                "sequence": 1,
+                "split_method": "simple",
+                "qty": qty or 2,
+                "carrier_ids": [(6, 0, ship_flow.carrier_ids.ids)],
+            }
+        )
+        return ship_flow, pick_flow
+
+    def _run_split_flow(self, qty=None):
+        pick_flow = self._get_flow("pick_ship")
+        moves_before = self.env["stock.move"].search([])
+        self._run_procurement(self.product, qty or 5, pick_flow.carrier_ids)
+        moves_after = self.env["stock.move"].search([])
+        return (moves_after - moves_before).sorted(lambda m: m.id)
```

## odoo/addons/stock_warehouse_flow/tests/test_warehouse_flow.py

```diff
@@ -1,8 +1,9 @@
 # Copyright 2022 Camptocamp SA
+# Copyright 2023 Michael Tietz (MT Software) <mtietz@mt-software.de>
 # License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl)
 
 from odoo.exceptions import UserError
 
 from . import common
 
 
@@ -95,7 +96,39 @@
         flow = self._get_flow("pick_ship")
         vals = flow.copy_data()[0]
         with self.assertRaises(UserError):
             vals["carrier_ids"] = [
                 (6, 0, self.env.ref("delivery.delivery_carrier").ids)
             ]
             self.env["stock.warehouse.flow"].create(vals)
+
+    def test_flow_qty_uom_constraint(self):
+        flow = self._get_flow("pick_ship")
+        flow.write({"qty": 0, "uom_id": False})
+        with self.assertRaises(UserError):
+            flow.write({"qty": 2})
+
+    def test_split(self):
+        self._prepare_split_test()
+        moves = self._run_split_flow()
+        self.assertEqual(moves.mapped("product_qty"), [4, 1, 4])
+        self.assertEqual(
+            moves.mapped("picking_type_id.code"), ["outgoing", "outgoing", "internal"]
+        )
+
+    def test_nothing_to_split(self):
+        self._prepare_split_test()
+        moves = self._run_split_flow(4)
+        self.assertEqual(moves.mapped("product_qty"), [4, 4])
+        self.assertEqual(moves.mapped("picking_type_id.code"), ["outgoing", "internal"])
+
+    def test_split_no_qty_match(self):
+        ship_flow, pick_flow = self._prepare_split_test(5)
+        ship_flow.unlink()
+        with self.assertRaises(UserError):
+            self._run_split_flow(4)
+
+    def test_split_no_flow_for_split_move(self):
+        ship_flow, pick_flow = self._prepare_split_test()
+        ship_flow.unlink()
+        with self.assertRaises(UserError):
+            self._run_split_flow()
```

## odoo/addons/stock_warehouse_flow/views/stock_warehouse_flow.xml

### odoo/addons/stock_warehouse_flow/views/stock_warehouse_flow.xml

```diff
@@ -29,14 +29,20 @@
                 =&gt;
                 <field name="from_location_src_id" nolabel="1"/>
                 to
                 <field name="from_location_dest_id" nolabel="1"/>
               </div>
               <field name="carrier_ids" widget="many2many_tags"/>
               <field name="move_domain" widget="domain" options="{'model': 'stock.move', 'in_dialog': true}"/>
+              <field name="split_method" string="Max quantity multiple"/>
+              <label for="qty" attrs="{'invisible': [('split_method', '!=', 'simple')]}"/>
+              <div name="qty" class="o_row">
+                <field name="qty" attrs="{'required': [('split_method', '=', 'simple')], 'invisible': [('split_method', '!=', 'simple')]}"/>
+                <field name="uom_id" options="{'no_open': True, 'no_create': True}" groups="uom.group_uom" attrs="{'required': [('split_method', '=', 'simple')], 'invisible': [('split_method', '!=', 'simple')]}"/>
+              </div>
             </group>
             <group name="to" string="To">
               <field name="delivery_steps" attrs="{'invisible': [('delivery_route_id', '!=', False)]}"/>
               <field name="sequence_prefix" attrs="{'invisible': [('delivery_route_id', '!=', False)], 'required': [('delivery_route_id', '=', False)]}"/>
               <field name="delivery_route_id" attrs="{'invisible': [('delivery_route_id', '=', False)]}"/>
               <field name="to_picking_type_id" attrs="{'invisible': [('delivery_route_id', '=', False)]}"/>
               <field name="to_output_stock_loc_id" attrs="{                 'readonly': [('delivery_route_id', '!=', False)],                 'invisible': [('delivery_steps', '=', 'ship_only')],                 }"/>
```

## Comparing `odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/METADATA` & `odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: odoo14-addon-stock-warehouse-flow
-Version: 14.0.1.0.3
+Version: 14.0.2.0.0
 Summary: Configure routing flow for stock moves
 Home-page: https://github.com/OCA/wms
 Author: Camptocamp, BCIM, Odoo Community Association (OCA)
 Author-email: support@odoo-community.org
 License: AGPL-3
 Platform: UNKNOWN
 Classifier: Programming Language :: Python
@@ -126,14 +126,15 @@
 * BCIM
 
 Contributors
 ~~~~~~~~~~~~
 
 * SÃ©bastien Alix <sebastien.alix@camptocamp.com>
 * Jacques-Etienne Baudoux <je@bcim.be>
+* Michael Tietz (MT Software) <mtietz@mt-software.de>
 
 Maintainers
 ~~~~~~~~~~~
 
 This module is maintained by the OCA.
 
 .. image:: https://odoo-community.org/logo.png
```

## Comparing `odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/RECORD` & `odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/RECORD`

 * *Files 5% similar despite different names*

```diff
@@ -1,35 +1,35 @@
-odoo/addons/stock_warehouse_flow/README.rst,sha256=24_sO6zqijmV7aC-lgrTSrnvRwhJXB-gG8NlZUmpwbU,4729
+odoo/addons/stock_warehouse_flow/README.rst,sha256=gHnGx5edBkgZ4W66qeofzuqXK5OWJoKf2G1He84gT4I,4783
 odoo/addons/stock_warehouse_flow/__init__.py,sha256=X9EJGOE2GtZbS0G82PtSXmWSZ_R8jEM0rlJTDliQjp4,21
-odoo/addons/stock_warehouse_flow/__manifest__.py,sha256=Tld43zYEgSLIbObUSWILoqW2ssWFcSbLEcmfdbiKlx0,901
+odoo/addons/stock_warehouse_flow/__manifest__.py,sha256=BRYTAqmOPHf1qoD9LFqhvhK02oTobotmGEY1JL4ntMk,901
 odoo/addons/stock_warehouse_flow/demo/stock_warehouse_flow.xml,sha256=9LO8C5ZmwSbSxKmNpJkIwx02d9jBTBDc1Y_g39cmT5g,1553
-odoo/addons/stock_warehouse_flow/i18n/stock_warehouse_flow.pot,sha256=DCzmla6ix7-eCq2Ou_qBx6iGuMpIz0gzgHL-_MJXLLk,13460
+odoo/addons/stock_warehouse_flow/i18n/stock_warehouse_flow.pot,sha256=hRJacwTA57yEPCb2A7yj419bVST1bgvyWvsVBa7AAIY,14914
 odoo/addons/stock_warehouse_flow/migrations/14.0.1.0.1/pre-migrate.py,sha256=d0z4JsSv_57GzEaC1pF1mYfxB7DavjryDhD2xGRngBs,688
 odoo/addons/stock_warehouse_flow/models/__init__.py,sha256=hefn47q9BM6jhCQVwhuEJSttssKoFcht2Ip0NnIBfQQ,156
 odoo/addons/stock_warehouse_flow/models/delivery_carrier.py,sha256=9IHRIW5dFFIeCEqGif-Z3GSRaCYCt-lGR_yrrp6FQSo,830
 odoo/addons/stock_warehouse_flow/models/stock_location_route.py,sha256=oOiTpPGL2znDyszLottZG1nLr36o2qN2vuvbUtWBh0g,910
-odoo/addons/stock_warehouse_flow/models/stock_move.py,sha256=Ixb69v9WVZ0iESrFDm4IqjfTIL31Wlxb3g2y_9SvGw4,747
+odoo/addons/stock_warehouse_flow/models/stock_move.py,sha256=vABEWaCbEpJkc0DQwZ5daz1QMdVgiDxF_BNfy_RJJ0I,1022
 odoo/addons/stock_warehouse_flow/models/stock_warehouse.py,sha256=4_oo5Pf63FYeO2dSF0VhbuY7rGxsdqVim3U_IybeF4Y,686
-odoo/addons/stock_warehouse_flow/models/stock_warehouse_flow.py,sha256=VkjipfR4ZStRlL2u4knNUEuFAc2gtke8d3iJ_YDBYTg,15527
+odoo/addons/stock_warehouse_flow/models/stock_warehouse_flow.py,sha256=tjCFwP_PhfjbfJTV44eOTK33XuJJiCoHffdHtQW6EJM,20247
 odoo/addons/stock_warehouse_flow/readme/CONFIGURE.rst,sha256=U7eeHOLb9uL4dhPHRGJYKH6B-8mY4_UL39JivChxgy0,795
-odoo/addons/stock_warehouse_flow/readme/CONTRIBUTORS.rst,sha256=P7DhF8R_d_QaQyKcY8FPmwxFzGIK9HnBcopqgT5Ox5Y,89
+odoo/addons/stock_warehouse_flow/readme/CONTRIBUTORS.rst,sha256=VhJodoi-hQ9pdfpaEzmqGUtxUiMhBDxfPl9VVlU2QSE,143
 odoo/addons/stock_warehouse_flow/readme/DESCRIPTION.rst,sha256=EwwmQHMbrJFwWgI1nwQIEgN44tdR8PDMPdT-jQXE2yw,751
 odoo/addons/stock_warehouse_flow/readme/ROADMAP.rst,sha256=CzUaG34cw2DgVB1J-dW1RGf4e9WDvpSXatiXIQnjo1k,112
 odoo/addons/stock_warehouse_flow/readme/USAGE.rst,sha256=IdIyCqZnmgNP7vuJTKb4FBUJaVg4piQzyVLubVxXHuo,130
 odoo/addons/stock_warehouse_flow/security/ir.model.access.csv,sha256=Xi7RrrBikCzrPgrI0IVDgOXuvojh4irPwsn9tY_f-B0,434
 odoo/addons/stock_warehouse_flow/static/description/config.png,sha256=DZ4wkprHpgucU0j4MEsGwzBd9quZOzw6M05e8X9ukeE,62641
 odoo/addons/stock_warehouse_flow/static/description/flow.png,sha256=95kcu77qBLP4k56Jzf7chGGTVsor0e84mZ2yYu0Mh50,36432
 odoo/addons/stock_warehouse_flow/static/description/icon.png,sha256=XUHr57xdKomSar6SVq06_iSyuyrWcY1XggSMDTgVQ_E,7354
-odoo/addons/stock_warehouse_flow/static/description/index.html,sha256=oRrj7gjrIgB75XQ8t5GlcDbqU_oK-FJ0I1P3a0ZTpi8,14923
+odoo/addons/stock_warehouse_flow/static/description/index.html,sha256=9iztxAfohb8eQp3LBZ1YdQaqwqZ1BwTDTTFswhgJGSs,15068
 odoo/addons/stock_warehouse_flow/tests/__init__.py,sha256=UI29InA5kzclFEhpUVvC795QyvZ4VIz88MicX37Wzqk,99
-odoo/addons/stock_warehouse_flow/tests/common.py,sha256=bb7t63qDhLVeWgmHx9Kn2TbKbYtdojmeIANuDmGm0Q4,2525
+odoo/addons/stock_warehouse_flow/tests/common.py,sha256=zFf-hUQZzI-42S7u9Cvvn39o1ioBGOazcT3BICTk6Ao,3389
 odoo/addons/stock_warehouse_flow/tests/test_delivery_carrier.py,sha256=1Wulmqu9cLNJz-PZEG8AVrGFtngE0E6PlF9NxDL6hcY,359
 odoo/addons/stock_warehouse_flow/tests/test_warehouse.py,sha256=BkkZfY62sB1DyZTuj0f6Fx6l4qgQbGMew-BPJAONzHQ,363
-odoo/addons/stock_warehouse_flow/tests/test_warehouse_flow.py,sha256=ejv9qiXU3Gp8THspD91PxL6IW9RGaK_jENCRf78m3XA,4333
+odoo/addons/stock_warehouse_flow/tests/test_warehouse_flow.py,sha256=Mlemv9h42dnmatiBqoTgMO3CP9Wn6NISpnEkjmopbRM,5587
 odoo/addons/stock_warehouse_flow/views/delivery_carrier.xml,sha256=uEp5pjAhuPAr3ysm5uAwAoSuAaFtCLs5ai5G_MQxTVc,882
 odoo/addons/stock_warehouse_flow/views/stock_location_route.xml,sha256=qzr92kOzeWZq6Dbz5TV1_oKZ_9SkqlLTdLRB3iuFfR4,598
 odoo/addons/stock_warehouse_flow/views/stock_warehouse.xml,sha256=JoFS4s5cX21Q1nmyC-GOFRlJADfKsGrS3RYRZn0x4mI,742
-odoo/addons/stock_warehouse_flow/views/stock_warehouse_flow.xml,sha256=EM5sLXjK7J5IdJEgR9Cfd-q4t_WDdWlb9UDy_lACFSI,9102
-odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/METADATA,sha256=DagFcPa06T8P6DcZo66-7LV4IPT5XHjYeC8q5iP1aSs,5390
-odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
-odoo14_addon_stock_warehouse_flow-14.0.1.0.3.dist-info/RECORD,,
+odoo/addons/stock_warehouse_flow/views/stock_warehouse_flow.xml,sha256=IPk99yP8T90zJ_qra7UBlP5MRZ5l6g_o4UkBWGA-uBU,10068
+odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/METADATA,sha256=GUxI7OvJmT66l7-k1kDWFw4THvCDmGFMZIYwoND4do0,5444
+odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/top_level.txt,sha256=qBj40grFkGOfDZ2WDSw3y1RnDlgG0u8rP8pvGNdbz4w,5
+odoo14_addon_stock_warehouse_flow-14.0.2.0.0.dist-info/RECORD,,
```

